#include "arithmetics"

fib_pair(x, y) = add(add(multiply(x, x), x), y);

fib_left(p) = sqrt(p);

fib_pair_sum(p, p_sqrt) = monus(p, multiply(p_sqrt, p_sqrt));
fibonacci_step(p, p_sqrt) = fib_pair(fib_pair_sum(p, p_sqrt), p_sqrt);

fibonacci_internal(0) = fib_pair(1, 0);
fibonacci_internal(n + 1) = fibonacci_step(fibonacci_internal, sqrt(fibonacci_internal));
fibonacci(n) = fib_left(fibonacci_internal(n));

fibonacci(11);